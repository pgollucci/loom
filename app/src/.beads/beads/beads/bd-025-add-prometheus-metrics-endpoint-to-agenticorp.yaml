entitymetadata:
    schemaversion: ""
    attributes: {}
    migratedat: null
    migratedfrom: ""
id: bd-025
type: feature
title: Add Prometheus metrics endpoint to AgentiCorp
description: |-
    Implement /metrics endpoint with standard Prometheus metrics.

    Metrics to track:
    - agenticorp_beads_processed_total (counter by status, priority)
    - agenticorp_agent_execution_duration_seconds (histogram)
    - agenticorp_provider_requests_total (counter by provider, status)
    - agenticorp_shell_commands_total (counter by exit_code)
    - Standard Go metrics (memory, goroutines, GC)

    Implementation:
    1. Add prometheus client library: go get github.com/prometheus/client_golang
    2. Create internal/metrics/prometheus.go with metric definitions
    3. Instrument key operations (bead processing, agent execution, commands)
    4. Add /metrics endpoint to server (no auth required)
    5. Update auth middleware to skip /metrics

    Deliverables:
    - Metrics endpoint returning Prometheus format
    - Integration with existing operations
    - Documentation for available metrics
status: in_progress
priority: 2
projectid: agenticorp-self
assignedto: agent-1769155372-Code Reviewer (Default)
blockedby: []
blocks: []
relatedto: []
parent: ""
children: []
tags: []
context:
    agent_id: agent-1769155372-Code Reviewer (Default)
    agent_output: |
        [mock] Work on bead bd-025: Add Prometheus metrics endpoint to AgentiCorp

        Context:
        Project: AgentiCorp Self-Improvement (agenticorp-self)
        Branch: main

        Project Context:
        - description: The AgentiCorp project itself - perpetual self-improvement
        - test_command: go test ./...
        - build_command: go build

        Bead ID: bd-025
        Type: feature
        Priority: P2
        Status: in_progress

        Bead Description:
        Implement /metrics endpoint with standard Prometheus metrics.

        Metrics to track:
        - agenticorp_beads_processed_total (counter by status, priority)
        - agenticorp_agent_execution_duration_seconds (histogram)
        - agenticorp_provider_requests_total (counter by provider, status)
        - agenticorp_shell_commands_total (counter by exit_code)
        - Standard Go metrics (memory, goroutines, GC)

        Implementation:
        1. Add prometheus client library: go get github.com/prometheus/client_golang
        2. Create internal/metrics/prometheus.go with metric definitions
        3. Instrument key operations (bead processing, agent execution, commands)
        4. Add /metrics endpoint to server (no auth required)
        5. Update auth middleware to skip /metrics

        Deliverables:
        - Metrics endpoint returning Prometheus format
        - Integration with existing operations
        - Documentation for available metrics

        Output format:
        1) Short plan
        2) Key questions/risks
        3) Concrete next actions (commands/files to change)
        4) Proposed patch snippets if applicable
    agent_task_id: task-bd-025-1769159643600237875
    agent_tokens: "2739"
    agent_worker_id: worker-agent-1769155372-Code Reviewer (Default)-1769159640
    dispatch_history: '["agent-1769155372-Code Reviewer (Default)"]'
    last_run_at: "2026-01-23T09:14:03Z"
    loop_detected: "false"
    provider_id: puck
    provider_model: nvidia/NVIDIA-Nemotron-3-Nano-30B-A3B-FP8
    redispatch_requested: "false"
createdat: 2026-01-23T00:07:43.315502426Z
updatedat: 2026-01-23T09:14:03.825909625Z
closedat: null
