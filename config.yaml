# Loom Configuration

server:
  http_port: 8081
  https_port: 8443
  enable_http: true
  enable_https: false
  tls_cert_file: ""  # Path to TLS certificate (when ready)
  tls_key_file: ""   # Path to TLS key (when ready)
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 120s

database:
  type: sqlite
  path: ./data/loom.db  # Resolves to /app/data/loom.db in container, ./data/loom.db natively

beads:
  bd_path: bd  # Path to bd executable
  auto_sync: true
  sync_interval: 5m
  compact_old_days: 90  # Compact closed beads older than 90 days
  backend: dolt          # "sqlite" or "dolt"
  federation:
    enabled: true
    auto_sync: true
    sync_interval: 10m
    sync_strategy: ours
    sync_mode: dolt-native
    peers: []            # Add peers via API or config for multi-container sync

agents:
  max_concurrent: 6
  default_persona_path: ./personas
  heartbeat_interval: 30s
  file_lock_timeout: 10m
  allowed_roles:
    - ceo
    - engineering-manager
    - project-manager
    - code-reviewer
    - qa
    - devops-engineer

dispatch:
  max_hops: 20

git:
  project_key_dir: ./data/projects

security:
  enable_auth: false  # Disabled for development - enable for production
  pki_enabled: false  # Will be enabled when certificates are provided
  ca_file: ""
  require_https: false
  jwt_secret: "change-me-in-production"
  allowed_origins:
    - "*"  # CORS - adjust in production
  # api_keys:
  #   - "your-api-key-here"

temporal:
  host: localhost:7233
  namespace: default
  task_queue: loom-tasks
  workflow_execution_timeout: 24h
  workflow_task_timeout: 10s
  enable_event_bus: true
  event_buffer_size: 1000

cache:
  enabled: true               # Enable response caching
  default_ttl: 1h             # Default time-to-live for cache entries
  max_size: 10000             # Maximum number of cached entries
  max_memory_mb: 500          # Maximum memory usage (approximate)
  cleanup_period: 5m          # How often to clean expired entries

providers:
  - id: plubbit-local
    name: Plubbit Local
    type: local
    endpoint: http://plubbit.local:8000/v1
    model: nvidia/NVIDIA-Nemotron-3-Nano-30B-A3B-FP8
    enabled: true
  - id: sparky-local
    name: Sparky Local
    type: local
    endpoint: http://sparky.local:8000/v1
    model: nvidia/NVIDIA-Nemotron-3-Nano-30B-A3B-FP8
    enabled: true
  - id: nvidia-cloud
    name: NVIDIA Inference API
    type: openai
    endpoint: https://inference-api.nvidia.com/v1
    api_key: ${NVIDIA_API_KEY}
    model: nvidia/openai/gpt-oss-20b
    enabled: true

projects:
  - id: loom-self
    name: Loom Self-Improvement
    git_repo: git@github.com:jordanhubbard/loom.git
    branch: main
    beads_path: .beads
    git_auth_method: ssh
    git_strategy: direct
    is_perpetual: true
    is_sticky: true
    context:
      build_command: "go build"
      test_command: "go test ./..."
      description: "The Loom project itself - perpetual self-improvement"
  # NOTE: Only one project should be configured at a time until multi-project
  # agent allocation is fixed. The system has a global max_concurrent agent limit
  # that prevents multiple projects from having their own agent teams.
  # - id: example-project
  #   name: Example Project
  #   git_repo: /path/to/repo
  #   branch: main
  #   beads_path: .beads
  #   context:
  #     build_command: "make build"
  #     test_command: "make test"

web_ui:
  enabled: true
  static_path: ./web/static
  refresh_interval: 5  # seconds

hot_reload:
  enabled: true  # Enable hot-reload for development
  watch_dirs:
    - "./web/static"  # Watch frontend files
    - "./personas"    # Watch persona definitions
  patterns:
    - "*.html"
    - "*.css"
    - "*.js"
    - "*.md"
    - "PERSONA.md"
